var _st={analytics:function(t){if(void 0===t)return!1;var e=t.page||!1,a=t.pageview||!1,s=t.event||!1,n=t.action||t.data;return data=t.data||!1,"string"==typeof n&&"object"==typeof data?ga(t.type,n,data):void 0!==t.type&&ga(t.type,n),s&&ga("send","event",s.name),a?e?ga("send","pageview",e):ga("send","pageview"):a},parseParams:function(t,e){return(t||document.location.search).replace(/(^\?)/,"").replace(e,"").split("&").map(function(t){return t=t.split("="),this[t[0]]=t[1],this}.bind({}))[0]},request:function(t){var e={url:t.route||"",method:t.method||"GET",headers:t.headers||{},processData:!1,dataType:t.dataType||"json",success:function(e){void 0!==t.success&&t.success(e)},error:function(e,a,s){void 0!==t.error&&t.error([e,a,s])}};"GET"!==e.method&&(e.data=JSON.stringify(t.cdata||{})),void 0!==t.accepts&&(e.accepts=t.accepts),$.ajax(e)},menu:function(t){$("body").toggleClass("nav-sidebar-open"),"function"==typeof t&&t()},closer:function(t){jQuery("body").removeClass("nav-sidebar-open modal-open"),"function"==typeof t&&t()},form:{valid:!1,disableForm:function(t){$(".signup-submit",t).prop("disabled",!this.valid)},validate:function(t){$("input,select",t).each(function(e,a){if(!$(this).is(":required")||!($(this).val()&&!$(this).hasClass("invalid")||$(this).hasClass("valid")))return _st.form.valid=!1,_st.form.disableForm(t),!1;_st.form.valid=!0}),this.disableForm(t)}},heartBeat:function(){_st.request({route:stajax.rootURL+"/ping.php",success:function(t){try{if(!t)throw new Exception("Invalid response from _st.heartBeat.");do{$(document).dequeue("heartbeat")}while($(document).queue("heartbeat").length)}catch(t){console.log(t)}},error:function(t,e,a){Materialize.toast("Offline",6e3),console.log(t,e,a)}})},login:function(t){_st.request({route:stajax.rest.url+"/auth",headers:{},success:function(e){t.append(e),_st.modal.loader()},error:function(t){console.log(t)}})},modal:($(".loading-spinner").each(function(t){$(this).attr("src",stajax.contentURL+"/i/sttv-spinner.gif")}),{action:"",element:$("#sttvmodal"),inner:$(".sttvmodal_inner"),init:function(t){if(void 0===t)return!1;if(this.action===t)return this.toggle();var e;switch("close"!==t&&(this.action=t,_st.modal.loader(function(){_st.modal.inner.empty()})),t){case"close":break;case"login":e=function(t){_st.login(t)};break;case"account":e=function(t){};break;case"mu-checkout":e=function(t){_st.mu.submit(t,"#mu_form_wrapper")};break;case"mu-signup":e=function(t){_st.mu.register(t,"#mu_form_wrapper")};break;case"sttv-cart":case"checkout":e=function(t){_st.cart.submit(!0,t)}}this.toggle(e)},toggle:function(t){$("body").toggleClass("modal-open"),"function"==typeof t&&t(_st.modal.inner)},loader:function(t){_st.modal.element.toggleClass("loader-active"),"function"==typeof t&&t(_st.modal.inner)}}),cart:function(){if("courses"===stajax.type)return!1;var t=JSON.parse(localStorage.getItem("_stcart_")),e=Date.now();(null===t||86400+(t.ID/1e3|0)<e/1e3|0)&&(t={ID:e,signature:btoa(navigator.userAgent+"|"+navigator.platform+"|"+navigator.product).replace(/=/g,""),items:{}});for(var a in t.items)"multi-user"===t.items[a].type&&delete t.items[a];var s=Object.keys(t.items).length,n=$("<div/>",{id:"cart-FAB"}),o=$("<a/>",{class:"cart-fab btn-floating btn-large z-depth-5"}),i=$("<i/>",{class:"material-icons",text:"shopping_cart"}),r=$("<div/>",{class:"cart-alert circle z-depth-2"});return $("body").addClass("sttv-jscart"),n.append(r.text(s)).append(o.append(i)).appendTo(document.body),s>0&&r.addClass("show").siblings(".cart-fab").addClass("pulse"),localStorage.setItem("_stcart_",JSON.stringify(t)),{cartObj:t,changed:[],add:function(t,e){if(e=e||!1,"object"!=typeof t)throw"Item must be an object";var a=this.cartObj.items,s="";return void 0===a[t.id]?(a[t.id]=t,s="Item added"):"subscription"!==t.type&&(a[t.id].qty+=t.qty,s="Quantity updated"),this.changed.push(t.id),this.save(e),_st.analytics({type:"ec:addProduct",data:{id:t.id,name:t.name,brand:"SupertutorTV",category:t.type,quantity:t.qty,price:(t.price/100).toFixed(2)}}),_st.analytics({type:"ec:setAction",action:"add"}),s},remove:function(t,e){return e=e||!1,"string"==typeof t&&(delete this.cartObj.items[t],this.save(e))},empty:function(t){return this.cartObj.items={},this.save(),"function"==typeof t&&t(this)},unset:function(t){return localStorage.removeItem("_stcart_"),"function"==typeof t&&t(this)},save:function(t){return localStorage.setItem("_stcart_",JSON.stringify(this.cartObj)),!t&&this.notifications.update()},get:function(){return this.cartObj.items},notifications:{count:s,element:r,update:function(){return this.count=Object.keys(_st.cart.cartObj.items).length,this.count<=0?$(".cart-alert").removeClass("show").siblings(".cart-fab").removeClass("pulse"):$(".cart-alert").addClass("show").siblings(".cart-fab").addClass("pulse"),$(".cart-alert").text(this.count),this.count}},submit:function(t,e){var a={init:t||!1,cart:this.get()};_st.analytics({type:"ec:setAction",action:"click",pageview:!0}),_st.request({route:stajax.rest.url+"/checkout",method:"POST",cdata:a,headers:{},success:function(t){_st.checkout="subscription",e.append(t.html),_st.modal.loader();for(var s in a.cart){var n=a.cart[s];_st.analytics({type:"ec:addProduct",data:{id:n.id,name:n.name,brand:"SupertutorTV",category:n.type,quantity:n.qty,price:(n.price/100).toFixed(2)}})}_st.analytics({type:"ec:setAction",action:"checkout",data:{step:1},pageview:!0,page:"/checkout"})},error:function(t){console.log(t);t[0].responseJSON;_st.modal.toggle(function(){_st.modal.loader()})}})}}}(),checkout:"",mu:{submit:function(t,e){var a={mukey:$("input[name=mukey]",e).val(),email:$("input[name=email]",e).val(),license:{id:$("select[name=sttv_course_id]",e).val(),title:$("select[name=sttv_course_id] option:selected",e).text(),qty:$("select[name=qty]",e).val()}};_st.request({route:stajax.rest.url+"/multi-user",method:"POST",cdata:a,headers:{"X-WP-Nonce":stajax.rest.nonce},success:function(e){_st.checkout="multi-user",_st.cart.empty(function(t){t.add(e.data,!0)}),t.append(e.html),_st.modal.loader(),console.log(e)},error:function(t){var a=t[0].responseJSON;$(".message",e).text(a.message),_st.modal.toggle(function(){_st.modal.loader()}),console.log(a)}})},register:function(t,e){var a={muid:$("input[name=mukey]",e).val(),email:$("input[name=sttv_email]",e).val(),password:$("input[name=sttv_password]",e).val(),firstName:$("input[name=sttv_firstname]",e).val(),lastName:$("input[name=sttv_lastname]",e).val()};_st.request({route:stajax.rest.url+"/checkout",method:"POST",cdata:a,headers:{"X-WP-Nonce":stajax.rest.nonce},success:function(e){t.append(e.html),_st.modal.loader(),setTimeout(function(){window.location.href=e.data.redirect},2e3),console.log(e)},error:function(t){console.log(t);var a=t[0].responseJSON;$(".message",e).text(a.message),_st.modal.toggle(function(){_st.modal.loader()})}})}},fn:function(){}};!function(t){"use strict";t("input, select","#mu_form_wrapper").on("change",function(t){_st.form.validate("#mu_form_wrapper"),_st.modal.action=""});t(document).on("click",".slide-bar, .modal-toggle, .mu-signup, .read-more, .mu-submitter, .cart-fab, .payment-launcher",function(e){e.preventDefault();var a=t(this),s=a.attr("class").split(/\s+/),n=a.attr("data-action"),o={"mu-signup":function(){_st.modal.init("mu-signup")},"payment-launcher":function(){_st.cart.add(JSON.parse(a.attr("data-bind"))),_st.modal.init(n)},"modal-toggle":function(){"account"==n?window.location.href=a.attr("href"):_st.modal.init(n)},"slide-bar":function(){_st.menu()},"read-more":function(){a.parent().css({display:"none"}),t("#content-wrapper").css({"max-height":"none"})},"mu-submitter":function(){_st.modal.init("mu-checkout")},"cart-fab":function(){_st.modal.init("sttv-cart")}};s.some(function(t){void 0!==o[t]&&o[t]()})});var e=t("body.nav-sidebar-open #main-nav");e.on("click touchstart",function(t){t.offsetX>e.offsetWidth&&(alert("Clicked!"),t.preventDefault(),_st.closer())}),t("li.menu-item-has-children>a").click(function(e){e.preventDefault(),t(this).siblings("ul.sub-menu").toggleClass("active").promise().done(function(){t("ul.sub-menu").not(this).removeClass("active")})}),t(document).on("submit","form#sttv_login_form",function(e){if(e.preventDefault(),0!==t("#sttv_user").val().length){var a='<img src="'+stajax.contentURL+'/i/sttv-spinner.gif" alt="Loading..." />',s=t(".loading_overlay");s.append(a).promise().done(function(){t(this).fadeIn(250)}),_st.request({route:stajax.rest.url+"/auth?action=login",method:"POST",headers:{"X-WP-Nonce":stajax.rest.nonce,"X-STTV-Auth":btoa(this.sttv_user.value+":"+this.sttv_pass.value)},success:function(e){"login_success"==e.code&&(s.empty().html('<p class="sblock"><strong><i class="material-icons">done</i></strong></p>').fadeIn(250),t(".sblock").hide().fadeIn(250),setTimeout(function(){window.location.href=e.redirect},250))},error:function(e){var a=e[0].responseJSON,n=void 0!==a.errors.too_many_retries?a.errors.too_many_retries[0]:a.message;t(".message").html(n),s.fadeOut(250),console.log(a)}})}else t(".message").html("Username is required")}),t("form#sttv_contact").on("submit",function(e){e.preventDefault();var a=t(".loading_overlay",t(this).parent()).html('<img src="'+stajax.contentURL+'/i/sttv-spinner.gif" alt="Loading..." />');a.fadeIn(250),_st.request({route:stajax.rest.url+"/contact",method:"POST",headers:{"X-WP-Nonce":stajax.rest.nonce},cdata:{g_recaptcha_response:grecaptcha.getResponse(),sttv_contact_name:this.sttv_contact_name.value,sttv_contact_email:this.sttv_contact_email.value,sttv_contact_subject:this.sttv_contact_subject.value,sttv_contact_message:this.sttv_contact_message.value},success:function(e){if(console.log(e),e.sent){a.empty().html('<p class="sblock"><strong><i class="material-icons">done</i></strong></p>').fadeIn(250);var s=t(".sblock");t("<p/>",{class:"smessage"}).appendTo(s).append(e.message),t(".sblock").hide().fadeIn(250)}else t(".message").html(e.message),a.fadeOut(250)},error:function(e){t(".message").html("Something went wrong. Please refresh the page and try again."),a.fadeOut(250),console.log(e)}})}),t("#subscribe_page_mc").on("submit",function(e){e.preventDefault();var a=t(this),s=t(".loading_overlay",t(this).parent()).html('<img src="'+stajax.contentURL+'/i/sttv-spinner.gif" alt="Loading..." />');s.fadeIn(250);var n={fname:t("#sttv_mc_fname",a).val(),lname:t("#sttv_mc_lname",a).val(),email:t("#sttv_mc_email",a).val(),g_recaptcha_response:grecaptcha.getResponse()};_st.request({route:stajax.rest.url+"/subscribe",method:"POST",cdata:n,headers:{"X-WP-Nonce":stajax.rest.nonce},success:function(e){t("input, button",a).prop("disabled",!0),grecaptcha.reset(),s.empty().html('<p class="sblock"><strong><i class="material-icons">done</i></strong></p>').fadeIn(250);var n=t(".sblock");t("<p/>",{class:"smessage"}).appendTo(n).append(e.message),t(".sblock").hide().fadeIn(250),console.log(e)},error:function(e){t(".message",a).html("Something went wrong. Please refresh the page and try again."),s.fadeOut(250),console.log(e)}})})}(jQuery),function(t){"use strict";t(document).ready(function(){t("select").material_select()})}(jQuery);
//# sourceMappingURL=sttv-js.min.js.map
